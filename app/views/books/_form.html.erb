<%= form_with(model: book, local: true, html: { multipart: true }) do |form| %>
  <% if book.errors.any? %>
    <div class="alert alert-danger alert-dismissible">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <h5><i class="icon fas fa-ban"></i> Помилка!</h5>
      <ul class="mb-0">
        <% book.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Назва -->
  <div class="form-group">
    <%= form.label :title, "Назва книги" %>
    <%= form.text_field :title, class: 'form-control', placeholder: 'Введіть назву книги' %>
  </div>

  <!-- Автор -->
  <div class="form-group">
    <%= form.label :author_id, 'Автор' %>
    <div class="input-group">
      <%= form.collection_select :author_id, 
          @authors,
          :id, 
          ->(author) { author.active ? author.name : "#{author.name} (неактивний)" },
          { prompt: 'Оберіть автора', include_blank: 'Без автора' },
          class: 'form-control' %>
      <div class="input-group-append">
        <button class="btn btn-outline-primary" type="button" data-toggle="modal" data-target="#newAuthorModal">
          <i class="fas fa-plus"></i> Новий
        </button>
      </div>
    </div>
    <small class="form-text text-muted">
      Оберіть автора зі списку або створіть нового
    </small>
  </div>

  <!-- Рік -->
  <div class="form-group">
    <%= form.label :year, "Рік видання" %>
    <%= form.number_field :year, class: 'form-control', placeholder: '1500-2030' %>
  </div>

  <!-- Опис -->
  <div class="form-group">
    <%= form.label :description, "Опис" %>
    <%= form.text_area :description, rows: 5, class: 'form-control', placeholder: 'Введіть опис книги' %>
  </div>

<!-- Обкладинка -->
<div class="mb-3">
  <%= form.label :cover, 'Обкладинка', class: 'form-label' %>
  
  <% if book.cover_url %>
    <div class="mb-2">
      <p class="text-muted">Поточна обкладинка:</p>
      <%= image_tag book.cover_url, class: 'img-thumbnail', style: 'max-width: 300px;' %>
    </div>
  <% end %>
  
  <%= form.file_field :cover, class: 'form-control', accept: 'image/jpeg,image/png,image/gif' %>
  <div class="form-text">JPG, PNG або GIF, максимум 5 MB</div>
</div>


  <!-- Кнопки -->
  <div class="form-group">
    <%= form.submit "Зберегти", class: 'btn btn-primary' %>
    <%= link_to 'Скасувати', books_path, class: 'btn btn-default' %>
  </div>
<% end %>

<!-- Modal для створення нового автора -->
<div class="modal fade" id="newAuthorModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Створити нового автора</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <%= form_with(model: Author.new, url: authors_path, local: false, id: 'new-author-form') do |author_form| %>
        <div class="modal-body">
          <div class="form-group">
            <%= author_form.label :name, "Ім'я автора" %>
            <%= author_form.text_field :name, class: 'form-control', required: true %>
          </div>

          <div class="form-group">
            <%= author_form.label :bio, "Біографія" %>
            <%= author_form.text_area :bio, rows: 4, class: 'form-control', required: true %>
          </div>

          <div class="form-check">
            <%= author_form.check_box :active, class: 'form-check-input', checked: true %>
            <%= author_form.label :active, "Активний автор", class: 'form-check-label' %>
          </div>
        </div>
        <div class="modal-footer justify-content-between">
          <button type="button" class="btn btn-default" data-dismiss="modal">Скасувати</button>
          <%= author_form.submit "Створити автора", class: 'btn btn-primary' %>
        </div>
      <% end %>
    </div>
  </div>
</div>

